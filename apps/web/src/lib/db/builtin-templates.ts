// ============================================================
// 内置任务模板（用于种子数据 / 快速创建常用编码任务）
// 模板 Prompt 使用 {{变量}} 占位符，用户创建任务时替换
// ============================================================

export const BUILTIN_TEMPLATES = [
  // ─────────────────── 缺陷修复 ───────────────────
  {
    id: 'tpl-bug-fix',
    name: '缺陷修复',
    titleTemplate: '修复: {{问题简述}}',
    promptTemplate: `你是一位资深软件工程师，请分析并修复以下缺陷。

## 问题描述
{{问题简述}}

## 复现步骤
{{复现步骤（如有）}}

## 要求
1. 定位根因，避免头痛医头式修补
2. 编写或补充覆盖该场景的单元测试
3. 确保修复不引入新的回归问题
4. 提交清晰的 commit message（Conventional Commits 格式）
5. 如果修改了公共接口，更新相关文档或注释`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 代码重构 ───────────────────
  {
    id: 'tpl-refactor',
    name: '代码重构',
    titleTemplate: '重构: {{重构目标}}',
    promptTemplate: `你是一位代码架构师，请对指定模块进行重构。

## 重构目标
{{重构目标}}

## 重构范围
{{涉及的文件或模块}}

## 原则
1. 保持外部行为不变（所有现有测试必须继续通过）
2. 遵循 SOLID 原则和 DRY 原则
3. 每个函数/方法不超过 50 行，每个文件不超过 400 行
4. 提取重复逻辑为可复用的工具函数
5. 改善命名，使代码自文档化
6. 分多个小 commit 提交，每个 commit 保持可编译状态
7. 不要在重构过程中引入新功能`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 新功能开发 ───────────────────
  {
    id: 'tpl-new-feature',
    name: '新功能开发',
    titleTemplate: '功能: {{功能名称}}',
    promptTemplate: `你是一位全栈工程师，请实现以下新功能。

## 功能描述
{{功能名称}}

## 详细需求
{{需求详情}}

## 验收标准
{{验收标准（如有）}}

## 要求
1. 遵循项目既有的架构模式和编码规范
2. 编写完整的单元测试，覆盖率不低于 80%
3. 处理边界条件和错误场景
4. 如涉及 API 变更，更新相关类型定义
5. 如涉及 UI 变更，确保响应式布局和无障碍支持
6. 使用 Conventional Commits 格式提交`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── UI 美化 ───────────────────
  {
    id: 'tpl-ui-polish',
    name: 'UI 美化',
    titleTemplate: 'UI: {{美化目标}}',
    promptTemplate: `你是一位前端 UI 工程师，请优化以下界面的视觉效果和用户体验。

## 美化目标
{{美化目标}}

## 当前问题
{{当前 UI 存在的问题}}

## 要求
1. 使用项目已有的设计令牌（颜色、间距、阴影、圆角等），禁止硬编码魔法值
2. 确保深色模式兼容（如项目支持）
3. 保持响应式布局，适配移动端和桌面端
4. 添加适当的过渡动画提升交互流畅度
5. 符合 WCAG 2.1 AA 无障碍标准（对比度、焦点可见等）
6. 不改变现有功能逻辑，只调整样式和布局
7. 使用 Tailwind CSS 工具类，避免自定义 CSS`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 性能优化 ───────────────────
  {
    id: 'tpl-perf-optimize',
    name: '性能优化',
    titleTemplate: '性能: {{优化目标}}',
    promptTemplate: `你是一位性能优化专家，请分析并优化以下性能问题。

## 优化目标
{{优化目标}}

## 当前表现
{{当前性能指标或现象}}

## 要求
1. 先分析性能瓶颈的根因，给出诊断报告
2. 按影响从大到小排列优化措施
3. 每项优化单独 commit，附带前后对比说明
4. 前端优化关注：包体积、首屏渲染、重渲染次数、内存泄漏
5. 后端优化关注：SQL 查询、N+1 问题、缓存策略、并发处理
6. 不因优化牺牲代码可读性，必要时添加注释解释优化理由
7. 确保所有现有测试通过`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 单元测试编写 ───────────────────
  {
    id: 'tpl-unit-test',
    name: '单元测试编写',
    titleTemplate: '测试: {{测试目标}}',
    promptTemplate: `你是一位测试工程师，请为指定模块编写全面的单元测试。

## 测试目标
{{测试目标（模块/文件/函数）}}

## 要求
1. 使用项目现有的测试框架和断言库
2. 覆盖率不低于 80%，核心逻辑需 100% 覆盖
3. 测试分类：
   - 正常路径（happy path）
   - 边界条件（空值、极值、类型边界）
   - 错误场景（异常输入、网络失败、超时）
4. 每个测试用例独立，不依赖执行顺序
5. 使用有意义的测试描述，读测试名即可理解验证意图
6. 适当使用 mock/stub 隔离外部依赖
7. 避免测试实现细节，聚焦行为验证`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 代码审查 ───────────────────
  {
    id: 'tpl-code-review',
    name: '代码审查',
    titleTemplate: '审查: {{审查范围}}',
    promptTemplate: `你是一位高级代码审查员，请对指定代码进行全面审查。

## 审查范围
{{审查范围（分支名/PR 号/文件路径）}}

## 审查维度
请从以下维度逐一评审并输出报告：

1. **代码质量** — 命名、可读性、复杂度、重复代码
2. **架构合理性** — 模块划分、依赖方向、关注点分离
3. **错误处理** — 异常捕获、降级策略、用户提示
4. **性能隐患** — 不必要的计算、内存泄漏、N+1 查询
5. **类型安全** — any 滥用、类型断言、空值处理
6. **测试覆盖** — 缺失的测试场景、测试质量

## 输出格式
- 每个问题标注严重级别：🔴 严重 / 🟡 建议 / 🟢 优化
- 给出具体的修复建议和代码示例
- 最后给出总结评分（0-100）和通过/退回建议`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── API 接口开发 ───────────────────
  {
    id: 'tpl-api-endpoint',
    name: 'API 接口开发',
    titleTemplate: 'API: {{接口名称}}',
    promptTemplate: `你是一位后端工程师，请实现以下 API 接口。

## 接口描述
{{接口名称}}

## 接口规格
- 路径: {{HTTP 方法}} {{路径}}
- 功能: {{功能描述}}

## 要求
1. 遵循 RESTful 设计规范
2. 实现完整的输入验证（参数类型、必填校验、边界值）
3. 使用统一的响应格式 { success, data, error }
4. 正确使用 HTTP 状态码（200/201/400/404/500）
5. 编写对应的集成测试
6. 更新相关的 TypeScript 类型定义
7. 处理并发和幂等性（如适用）`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 数据库变更 ───────────────────
  {
    id: 'tpl-db-migration',
    name: '数据库变更',
    titleTemplate: 'DB: {{变更描述}}',
    promptTemplate: `你是一位数据库工程师，请完成以下数据库变更。

## 变更描述
{{变更描述}}

## 详细设计
{{表结构/字段/索引变更详情}}

## 要求
1. 编写 Drizzle ORM schema 变更
2. 生成迁移文件（drizzle-kit generate）
3. 新增字段必须考虑默认值和向后兼容
4. 添加必要的索引以保证查询性能
5. 更新相关的 TypeScript 类型定义
6. 编写数据迁移脚本（如涉及存量数据转换）
7. 提供回滚方案`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 文档编写 ───────────────────
  {
    id: 'tpl-documentation',
    name: '文档编写',
    titleTemplate: '文档: {{文档主题}}',
    promptTemplate: `你是一位技术文档工程师，请编写或更新以下文档。

## 文档主题
{{文档主题}}

## 文档类型
{{README / API 文档 / 架构设计 / 使用指南 / 变更日志}}

## 要求
1. 使用简体中文编写
2. 结构清晰，层次分明（使用标题、列表、表格组织内容）
3. 包含实际可运行的代码示例
4. API 文档需包含：端点、参数、响应格式、错误码
5. 架构文档需包含：组件图、数据流、技术选型理由
6. 使用指南需包含：前置条件、步骤说明、常见问题
7. 保持与代码实现同步，不包含过时信息`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 依赖升级 ───────────────────
  {
    id: 'tpl-deps-upgrade',
    name: '依赖升级',
    titleTemplate: '升级: {{升级目标}}',
    promptTemplate: `你是一位 DevOps 工程师，请完成以下依赖升级。

## 升级目标
{{升级目标（具体包名或"全量升级"）}}

## 要求
1. 先检查当前版本和最新版本的差异
2. 阅读 CHANGELOG / Migration Guide，识别 Breaking Changes
3. 按依赖层级从底向上逐个升级
4. 每个依赖升级单独 commit
5. 每次升级后运行完整测试套件，确保无回归
6. 如有 Breaking Changes，同步修改受影响的代码
7. 更新 lock 文件（pnpm-lock.yaml）
8. 在 commit message 中注明升级前后版本号`,
    agentDefinitionId: 'claude-code',
  },

  // ─────────────────── 国际化 ───────────────────
  {
    id: 'tpl-i18n',
    name: '国际化处理',
    titleTemplate: 'i18n: {{国际化范围}}',
    promptTemplate: `你是一位前端工程师，请完成以下国际化处理。

## 国际化范围
{{国际化范围（页面/组件/模块）}}

## 要求
1. 提取所有硬编码的中文文案到统一的消息文件
2. 遵循项目现有的 i18n 消息组织结构（参考 lib/i18n/）
3. 消息 key 使用语义化命名（如 pageTitle、emptyHint）
4. 保留原有的文案内容，不修改文案措辞
5. 确保动态文案使用函数形式（如包含变量的模板字符串）
6. 验证所有页面渲染正常，无遗漏的硬编码文案`,
    agentDefinitionId: 'claude-code',
  },

  // ═══════════════════ Codex 专用模板 ═══════════════════

  // ─────────────────── Codex: 缺陷修复 ───────────────────
  {
    id: 'tpl-codex-bug-fix',
    name: '缺陷修复（Codex）',
    titleTemplate: '修复: {{问题简述}}',
    promptTemplate: `请分析并修复以下缺陷。

## 问题描述
{{问题简述}}

## 复现步骤
{{复现步骤（如有）}}

## 要求
1. 定位根因，避免表面修补
2. 编写或补充覆盖该场景的测试
3. 确保修复不引入新的回归问题
4. 每个逻辑变更独立 commit，使用 Conventional Commits 格式
5. 如果修改了公共接口，更新相关文档或注释`,
    agentDefinitionId: 'codex',
  },

  // ─────────────────── Codex: 新功能开发 ───────────────────
  {
    id: 'tpl-codex-feature',
    name: '新功能开发（Codex）',
    titleTemplate: '功能: {{功能名称}}',
    promptTemplate: `请实现以下新功能。

## 功能描述
{{功能名称}}

## 详细需求
{{需求详情}}

## 验收标准
{{验收标准（如有）}}

## 要求
1. 遵循项目既有的架构模式和编码规范
2. 编写完整的单元测试，覆盖率不低于 80%
3. 处理边界条件和错误场景
4. 如涉及 API 变更，更新相关类型定义
5. 每个功能点独立 commit，保持每次提交可编译
6. 使用 Conventional Commits 格式`,
    agentDefinitionId: 'codex',
  },

  // ─────────────────── Codex: 代码重构 ───────────────────
  {
    id: 'tpl-codex-refactor',
    name: '代码重构（Codex）',
    titleTemplate: '重构: {{重构目标}}',
    promptTemplate: `请对指定模块进行重构。

## 重构目标
{{重构目标}}

## 重构范围
{{涉及的文件或模块}}

## 原则
1. 保持外部行为不变（所有现有测试必须继续通过）
2. 遵循 SOLID 原则和 DRY 原则
3. 每个函数/方法不超过 50 行，每个文件不超过 400 行
4. 提取重复逻辑为可复用的工具函数
5. 改善命名，使代码自文档化
6. 分多个小 commit 提交，每个 commit 保持可编译状态`,
    agentDefinitionId: 'codex',
  },

  // ─────────────────── Codex: 代码审查 ───────────────────
  {
    id: 'tpl-codex-review',
    name: '代码审查（Codex）',
    titleTemplate: '审查: {{审查范围}}',
    promptTemplate: `请对指定代码进行全面审查。

## 审查范围
{{审查范围（分支名/文件路径）}}

## 审查维度
请从以下维度逐一评审并输出报告：

1. **代码质量** — 命名、可读性、复杂度、重复代码
2. **架构合理性** — 模块划分、依赖方向、关注点分离
3. **错误处理** — 异常捕获、降级策略、用户提示
4. **性能隐患** — 不必要的计算、内存泄漏、N+1 查询
5. **类型安全** — any 滥用、类型断言、空值处理
6. **测试覆盖** — 缺失的测试场景、测试质量

## 输出格式
- 每个问题标注严重级别：🔴 严重 / 🟡 建议 / 🟢 优化
- 给出具体的修复建议和代码示例
- 最后给出总结评分（0-100）和通过/退回建议`,
    agentDefinitionId: 'codex',
  },
] as const;
