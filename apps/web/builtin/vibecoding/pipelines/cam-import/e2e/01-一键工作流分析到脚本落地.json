{
  "version": 1,
  "type": "cam-pipeline",
  "exportedAt": "2026-02-23T01:21:43.460Z",
  "name": "端到端｜一键工作流分析到脚本落地",
  "agentDefinitionId": "codex",
  "repoUrl": null,
  "baseBranch": null,
  "workDir": null,
  "maxRetries": 2,
  "steps": [
    {
      "title": "分析/审查：项目构建与一键运行工作流（仅分析版）",
      "description": "# 项目构建与一键运行工作流（仅分析版）\n\n【输入】\n- scope：分析范围（默认全仓库；可留空模块/服务）。\n- report_path：报告路径（默认 `.conversations/reports/build-workflow-analysis-report.md`）。\n- acceptance_criteria：至少包含“现有入口盘点、缺口清单、跨平台策略、3-7 步执行计划、验证设计”。\n- constraints：支持 OS、是否允许运行探测命令、时间预算。\n- （可留空）preferred_commands：希望暴露的命令名（如 `dev/build/test`）。\n- （可留空）handoff_output_dir：默认 `.conversations/pipeline-handoffs/<pipeline_id>/`。\n\n【需要完成的功能】\n- 仅做工作流分析与编排：梳理仓库可用入口并输出一键流程方案（不改代码）。\n\n【注意事项】\n- 通用分析基线（必须）：先范围与现状→再结论与方案→最后验证设计；最多追问 3 个阻塞问题；每条 `acceptance_criteria` 必须有证据；按【输出】原样输出。\n- 严格单一职责：仅分析不改代码；不输出“已落地改动”。\n- 默认从仓库推断入口（`package.json/Makefile/pyproject.toml` 等），不要向用户追问可扫描信息。\n- 必须写清跨平台差异（Windows/Linux/macOS）与统一命令约定。\n- 报告必须落盘到 `report_path`；如提供 `handoff_output_dir`，结束时写 `step-summary.md` 与 `step-handoff.json`。\n\n【输出】\n- 扫描结论（现有入口、可用命令、缺口与证据）。\n- 一键流程方案（install/dev/test/build/release 的推荐编排）。\n- 跨平台策略（命令差异、路径差异、编码与返回码策略）。\n- 执行计划（3-7 步：目标/影响面/验证方式/回滚点）。\n- 验证设计（成功路径 + 至少 1 条失败路径）。\n- 分析报告（已保存路径 + 报告摘要）。\n- 流水线交接文件（若提供 `handoff_output_dir`：`step-summary.md` + `step-handoff.json`）。\n- 验收映射表（acceptance_criteria → 证据 → 结论）。\n- 机器可读摘要（JSON）：{\"status\":\"success|partial|blocked\",\"scope\":[],\"workflow_plan\":[],\"evidence\":[],\"next_actions\":[]}。\n\n流水线通信要求（必须执行）：\n- 本步骤结束前必须写入以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-summary.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\n- `step1-summary.md` 必须包含：输入范围、关键发现（P0/P1/P2）、报告路径、阻塞项。\n- `step1-handoff.json` 必填字段：\n  - pipeline_id（固定为当前流水线 id）\n  - step（固定为 \"step1\"）\n  - upstream_title（固定为 \"项目构建与一键运行工作流（仅分析版）\"）\n  - upstream_report_path（本步骤实际产出的 report_path）\n  - summary_path（固定为 \".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-summary.md\"）\n  - priority_items（数组，按优先级排序）\n  - blockers（数组）\n  - generated_at（ISO 时间）",
      "agentDefinitionId": "codex"
    },
    {
      "title": "执行整改：跨平台一键脚本（执行版）",
      "description": "# 跨平台一键脚本（执行版）\n\n【输入】\n- scope：默认“整个仓库（跨平台一键脚本）”。\n- workflow_report_path：工作流分析报告路径（默认 `.conversations/reports/build-workflow-analysis-report.md`）。\n- acceptance_criteria：明确每个入口的成功标准、失败返回码与最小可复现验证。\n- constraints：\n  - 不允许硬编码端口：优先读取 env/参数；缺省时自动探测空闲端口并打印最终端口。\n  - Python 项目必须使用 `uv`（默认 `.venv`），运行/测试优先 `uv run`。\n  - 禁止静默下载未知工具；缺工具必须输出安装指引并退出。\n  - 必须兼容中文路径与空格路径。\n- （可留空）script_layout：偏好入口形态（`npm scripts`/`Makefile`/`justfile`/`scripts/*`）。\n- （可留空）upstream_handoff_path：上一步交接文件路径。\n- （可留空）handoff_output_dir：默认 `.conversations/pipeline-handoffs/<pipeline_id>/`。\n\n【需要完成的功能】\n- 为当前仓库落地一套跨平台一键入口（Windows/Linux/macOS 通用）：`install`、`run`（可留空）、`test`（可留空）、`build/package`（可留空）。\n- 目标：同一套提示词可在不同系统直接复用，不按操作系统拆分模板。\n\n【注意事项】\n- 通用执行基线（必须）：仅执行落地（不做全面审查/分析）；先确认目标与验收（≤3 行）→扫描仓库事实→3-7 步执行（每步含影响面/验证/回滚）→回填证据；最多追问 3 个阻塞问题；每条 `acceptance_criteria` 必须映射证据；至少 1 条失败路径验证；非本轮问题写入“风险补充”；按【输出】原样输出。\n- 必须先读取 `workflow_report_path`（以及可选的 `upstream_handoff_path`）并对齐步骤优先级。\n- 统一入口优先：优先复用仓库现有入口（如 `npm run`/`make`/`uv run`）；不要按 OS 拆成两套流程文档。\n- 脚本策略：若必须落地脚本，使用“同语义双壳”最小实现（`scripts/*.sh` + `scripts/*.bat`），并保证参数与行为一致。\n- 编码策略：Shell 脚本用 UTF-8 + LF；`.bat` 用 UTF-8（必要时 `chcp 65001 >nul`）+ CRLF，并返回明确退出码。\n- 所有可调参数（端口、路径、profile、额外参数）集中在脚本顶部或统一配置文件。\n- 至少执行 `install` + `test`（或等价 smoke）并留痕，附跨平台差异说明（如命令前缀、路径分隔符）。\n- 如提供 `handoff_output_dir`，结束时必须写 `step-summary.md` 与 `step-handoff.json`。\n\n【输出】\n- 输入确认结果（范围、验收口径、约束）。\n- 扫描结论（技术栈、现有入口、跨平台差异点、可复用工具链）。\n- 执行计划（3-7 步，每步含影响面/验证/回滚点）。\n- 变更清单（按文件：入口脚本/配置/文档，改动内容与原因）。\n- 验证命令与结果摘要（至少含成功路径 + 1 条失败路径）。\n- 风险补充（未完成项/原因/下一步）。\n- 回归清单（install/run/test/build 的最小可用路径 + 端口冲突场景）。\n- 常见失败排查（工具缺失/环境变量缺失/路径与权限/外部依赖未启动）。\n- 流水线交接文件（若提供 `handoff_output_dir`：`step-summary.md` + `step-handoff.json`）。\n- 验收映射表（acceptance_criteria → 改动点 → 验证证据）。\n- 机器可读摘要（JSON）：{\"status\":\"success|partial|blocked\",\"scope\":[],\"changed_files\":[],\"verification\":[],\"unresolved\":[],\"next_actions\":[]}。\n\n流水线通信要求（必须执行）：\n- 本步骤开始前必须读取以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-summary.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\n- 若通信文件缺失或字段不完整：必须先输出阻塞原因与修复动作，不得直接跳过。\n- 本步骤整改必须逐条映射 step1 的优先级问题，并在输出中给出“问题 → 改动 → 验证”映射。\n- 本步骤结束前必须写入以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-summary.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-handoff.json\n- `step2-summary.md` 必须包含：执行计划、变更清单、验证结果、未完成项。\n- `step2-handoff.json` 必填字段：\n  - pipeline_id / step(\"step2\")\n  - input_handoff_path（固定为 \".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\"）\n  - summary_path（固定为 \".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-summary.md\"）\n  - changed_files（数组）\n  - verification_commands（数组）\n  - unresolved_items（数组）\n  - generated_at（ISO 时间）\n\n补充要求：\n1. 必须基于上一步的分析/审查结果逐条整改，不允许跳过高优先级问题。\n2. 若上一步生成了报告，必须读取默认 report_path 并做“问题→改动→验证”一一映射。\n3. 本步骤必须实际改代码并完成验证，不仅给结论。",
      "agentDefinitionId": "codex"
    },
    {
      "title": "复审核验：一键流程落地结果复审（仅审查版）",
      "description": "# 一键流程落地结果复审（仅审查版）\n\n【输入】\n- scope：复审范围（脚本/命令入口/文档）。\n- report_path：报告路径（默认 `.conversations/reports/build-workflow-regression-review-report.md`）。\n- execution_handoff_path：执行步骤交接文件路径（如 `.conversations/pipeline-handoffs/<pipeline_id>/step2-handoff.json`）。\n- acceptance_criteria：至少包含“入口可用性、失败路径可验证、跨平台差异说明、复审结论”。\n- constraints：审查深度、时间预算、是否允许运行验证命令。\n- （可留空）handoff_output_dir：默认 `.conversations/pipeline-handoffs/<pipeline_id>/`。\n\n【需要完成的功能】\n- 仅做一键流程落地结果复审：核对一键入口是否可用、跨平台差异是否受控、关键路径是否可回归（不改代码）。\n\n【注意事项】\n- 通用审查基线（必须）：先扫描事实→再分级问题→最后给结论；最多追问 3 个阻塞问题；每条 `acceptance_criteria` 必须有证据；按【输出】原样输出。\n- 严格单一职责：仅审查不改代码。\n- 必须读取 `execution_handoff_path`，并核对“入口项 → 改动点 → 验证证据”映射完整性。\n- 重点核对：`install/run/test/build`（或等价入口）可执行性、返回码规范、端口冲突与缺依赖失败路径。\n- 报告必须落盘到 `report_path`；如提供 `handoff_output_dir`，结束时写 `step-summary.md` 与 `step-handoff.json`。\n\n【输出】\n- 扫描结论（复审范围、输入来源、可用命令、可信度说明）。\n- 问题清单（P0/P1/P2：位置/影响/证据/修复建议/验证方式）。\n- 入口可用性清单（入口项 → 可用状态 → 证据）。\n- 回归风险清单（跨平台兼容/失败路径/文档一致性）。\n- 验证清单（已执行命令 + 结果摘要；未执行项手工步骤）。\n- 审查报告（已保存路径 + 报告摘要）。\n- 复审结论（通过/需继续整改/阻塞）。\n- 流水线交接文件（若提供 `handoff_output_dir`：`step-summary.md` + `step-handoff.json`）。\n- 验收映射表（acceptance_criteria → 证据 → 结论）。\n- 机器可读摘要（JSON）：{\"status\":\"success|partial|blocked\",\"scope\":[],\"entry_status\":[],\"regression_risks\":[],\"next_actions\":[]}。\n\n流水线通信要求（必须执行）：\n- 本步骤开始前必须读取以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-summary.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\n  3) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-summary.md\n  4) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-handoff.json\n- 若通信文件缺失或字段不完整：必须先输出阻塞原因与修复动作，不得直接跳过。\n- 本步骤复审必须逐条核对 step2 的改动与验证证据，输出“问题关闭状态 + 回归风险”。\n- 本步骤结束前必须写入以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step3-summary.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step3-handoff.json\n- `step3-summary.md` 必须包含：复审结论、问题关闭状态、回归风险、阻塞项。\n- `step3-handoff.json` 必填字段：\n  - pipeline_id / step(\"step3\")\n  - input_handoffs（固定为 [\".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\", \".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-handoff.json\"]）\n  - summary_path（固定为 \".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step3-summary.md\"）\n  - review_decision（approved / revise_required / blocked）\n  - closed_items（数组）\n  - open_items（数组）\n  - generated_at（ISO 时间）",
      "agentDefinitionId": "codex"
    },
    {
      "title": "端到端交付验收",
      "description": "请基于上一步执行结果进行最终校验与交付整理：\n1. 对照原始目标逐条核对完成状态，明确已完成/未完成/阻塞项。\n2. 汇总可验证证据（命令、结果摘要、关键输出路径）。\n3. 输出可直接交付的结构化结果：变更清单、验证结果、回归清单、风险与下一步行动。\n4. 若上一步是审查或分析任务，必须确认报告已落盘并给出保存路径与摘要。\n\n流水线通信要求（必须执行）：\n- 本步骤开始前必须读取以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-summary.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\n  3) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-summary.md\n  4) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-handoff.json\n  5) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step3-summary.md\n  6) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step3-handoff.json\n- 若存在缺失：必须先输出阻塞原因，不得直接给“已完成”。\n- 本步骤结束前必须写入以下文件：\n  1) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/final-delivery.md\n  2) .conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/final-delivery.json\n- `final-delivery.md` 必须包含：完成度核对、证据清单、回归清单、风险与下一步行动。\n- `final-delivery.json` 必填字段：\n  - pipeline_id / step(\"final\")\n  - input_handoffs（固定为 [\".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step1-handoff.json\",\".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step2-handoff.json\",\".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/step3-handoff.json\"]）\n  - summary_path（固定为 \".conversations/pipeline-handoffs/01-一键工作流分析到脚本落地/final-delivery.md\"）\n  - status（success / partial / blocked）\n  - completed_items（数组）\n  - pending_items（数组）\n  - generated_at（ISO 时间）",
      "agentDefinitionId": "codex"
    }
  ]
}
