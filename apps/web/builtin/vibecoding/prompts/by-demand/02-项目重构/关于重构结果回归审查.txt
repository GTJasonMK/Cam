# 重构结果回归审查（仅审查版）

【输入】
- scope：审查范围（模块/目录/接口）。
- report_path：报告路径（默认 `.conversations/reports/refactor-regression-review-report.md`）。
- execution_handoff_path：执行步骤交接文件路径（如 `.conversations/pipeline-handoffs/<pipeline_id>/step-handoff.json`）。
- acceptance_criteria：至少包含“重构目标达成度、回归风险、阻塞项、合入建议”。
- constraints：审查深度、时间预算、是否允许运行验证命令。
- （可留空）handoff_output_dir：默认 `.conversations/pipeline-handoffs/<pipeline_id>/`。

【需要完成的功能】
- 仅做重构结果审查：核对重构改动是否达成目标且无功能回退（不改代码）。

【注意事项】
- 通用审查基线（必须）：先扫描事实→再分级问题→最后给结论；最多追问 3 个阻塞问题；每条 `acceptance_criteria` 必须有证据；按【输出】原样输出。
- 严格单一职责：仅审查不改代码。
- 必须先读取 `execution_handoff_path`，无法读取时先输出阻塞原因与修复动作。
- 重点核对：核心链路回归、接口兼容性、异常路径、性能回退、测试覆盖变化。
- 报告必须落盘到 `report_path`；如提供 `handoff_output_dir`，结束时写 `step-summary.md` 与 `step-handoff.json`。

【输出】
- 扫描结论（审查范围、执行输入、可用命令、可信度说明）。
- 问题清单（P0/P1/P2：位置/影响/证据/修复建议/验证方式）。
- 重构目标达成度（目标项 → 达成状态 → 证据）。
- 回归风险清单（功能/性能/兼容性/可维护性）。
- 验证清单（已执行命令 + 结果摘要；未执行项的手工步骤）。
- 审查报告（已保存路径 + 报告摘要）。
- 合入结论（可合入/需修复后复审/阻塞）。
- 流水线交接文件（若提供 `handoff_output_dir`：`step-summary.md` + `step-handoff.json`）。
- 验收映射表（acceptance_criteria → 问题分级/证据/结论）。
- 机器可读摘要（JSON）：{"status":"success|partial|blocked","scope":[],"findings":[],"regression_risks":[],"merge_decision":"","next_actions":[]}。
