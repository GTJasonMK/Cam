# API 文档与 OpenAPI 维护（执行版）

【输入】
- scope：覆盖范围（默认全量公共 API；可留空模块/路由前缀/服务）。
- acceptance_criteria：
  - 每个接口至少含：路径方法、用途、请求参数、响应结构、错误场景、示例。
  - 文档与实现一致，需有最小 smoke/测试证据。
  - 产物可入库（如 `openapi.yaml/json`、`docs/api.md`、README API 入口）。
- constraints：是否强制 OpenAPI、是否允许新依赖/生成工具、是否允许改接口契约、篇幅限制。

【需要完成的功能】
- 补齐或修正文档，使 API 可发现、可调用、可验证；标准化产物优先 OpenAPI。
- （可留空）priority_endpoints（3-10 个）、auth_notes。

【注意事项】
- 通用执行基线（必须）：先确认目标与验收（≤3 行）→扫描仓库事实→3-7 步执行（每步含影响面/验证/回滚）→回填证据；最多追问 3 个阻塞问题；每条 `acceptance_criteria` 必须映射证据；至少 1 条失败路径验证；按【输出】原样输出。
- 默认从仓库推断 API 组织约定（路由/控制器/校验/错误/版本/分页），并引用 2-3 个相似接口作为证据。
- 文档策略优先复用现状：已有 OpenAPI 则更新；无则先最小方案并在 3 问内确认。
- 示例不得包含真实密钥/Token。
- 能跑就跑 test/build/smoke/OpenAPI 校验并留痕；不能跑给最小手工验证（含 curl）。

【输出】
- 输入确认结果（范围、验收口径、约束）。
- 扫描结论（API 入口、约定、相似实现、文档现状、可用命令）。
- 执行计划（3-7 步，每步含验证与回滚点）。
- 文档策略（更新现有 OpenAPI / 新增最小 OpenAPI / 仅 docs，含理由）。
- API 清单（覆盖范围、优先级、补齐状态）。
- 文档落地文件（OpenAPI 文件、可读文档、请求示例）。
- 变更清单（按文件：改动内容/原因）。
- 验证命令与结果摘要（含一致性证据）。
- 风险补充（未完成项/原因/下一步）。
- 回归清单（成功/失败/鉴权边界 + 文档入口可发现性）。
- 验收映射表（acceptance_criteria → 改动点 → 验证证据）。
- 机器可读摘要（JSON）：{"status":"success|partial|blocked","scope":[],"changed_files":[],"verification":[],"unresolved":[],"next_actions":[]}。
