# 上传前扫描与风险审查（仅审查版）

【输入】
- scope：扫描范围（默认全仓库；可留空目录/模块）。
- report_path：报告路径（默认 `.conversations/reports/github-upload-precheck-report.md`）。
- acceptance_criteria：至少包含“风险清单、`.gitignore` 缺口、必须补齐文件、整改优先级”。
- constraints：
  - 不做物理删除与批量改写，仅输出审查结果。
  - 构建产物与依赖目录不作为“删除建议”，应给 `.gitignore` 建议。
- （可留空）handoff_output_dir：默认 `.conversations/pipeline-handoffs/<pipeline_id>/`。

【需要完成的功能】
- 仅做 GitHub 上传前扫描：识别仓库结构问题、忽略规则缺口、敏感信息风险（不改代码）。

【注意事项】
- 通用审查基线（必须）：先扫描事实→再分级问题→最后给路线图；最多追问 3 个阻塞问题；每条 `acceptance_criteria` 必须有证据；按【输出】原样输出。
- 严格单一职责：仅审查不改代码。
- 必查项：敏感信息、临时/缓存文件、IDE 配置、系统特有垃圾文件、大文件、失效文档入口。
- 风险必须可执行：每条都给“发现位置 + 影响 + 推荐动作 + 验证方式”。
- 报告必须落盘到 `report_path`；如提供 `handoff_output_dir`，结束时写 `step-summary.md` 与 `step-handoff.json`。

【输出】
- 扫描结论（目录现状、忽略规则现状、敏感风险概览）。
- 风险清单（P0/P1/P2：位置/影响/证据/建议动作/验证方式）。
- `.gitignore` 补齐建议（按规则分组，说明覆盖范围）。
- 上传前整改优先级路线图（先做什么、后做什么）。
- 审查报告（已保存路径 + 报告摘要）。
- 流水线交接文件（若提供 `handoff_output_dir`：`step-summary.md` + `step-handoff.json`）。
- 验收映射表（acceptance_criteria → 问题分级/证据/建议）。
- 机器可读摘要（JSON）：{"status":"success|partial|blocked","scope":[],"findings":[],"gitignore_gaps":[],"next_actions":[]}。
